<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>BD TM EARNING BOT</title>

<!-- Monetage SDK -->
<script src='//libtl.com/sdk.js' data-zone='9802379' data-sdk='show_9802379'></script>
<!-- Telegram Web App -->
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
:root {
    --tg-theme-bg-color: #121212; --tg-theme-text-color: #e0e0e0; --tg-theme-button-color: #007bff;
    --tg-theme-button-text-color: #ffffff; --tg-theme-hint-color: #8a8a8a; --success-color: #28a745;
    --warning-color: #ffc107; --danger-color: #dc3545; --secondary-bg-color: #1e1e1e; --border-color: #333333;
}
body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
    margin:0; padding:20px 15px 90px 15px;
    background-color: var(--tg-theme-bg-color); color: var(--tg-theme-text-color);
    display:flex; flex-direction:column; align-items:center; text-align:center; min-height:100vh; box-sizing:border-box;
}
.container { width:100%; max-width:500px; }
.view { display:none; width:100%; animation:fadeIn 0.3s ease-in-out; }
#home-view { display:block; }
@keyframes fadeIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }
.header { margin-bottom:25px; }
.header h1 { font-size:32px; font-weight:700; margin-bottom:5px; color:#ffffff; }
.header p { color: var(--tg-theme-hint-color); font-size:16px; }
.card {
    background-color: var(--secondary-bg-color); padding:25px; border-radius:16px; margin-bottom:25px;
    box-shadow:0 8px 16px rgba(0,0,0,0.2); border:1px solid var(--border-color);
}
.card h2 { margin:0 0 12px 0; font-size:16px; color:var(--tg-theme-hint-color); font-weight:500; text-transform:uppercase; letter-spacing:0.5px; }
.balance-amount { font-size:42px; font-weight:700; color:#ffffff; margin-bottom:10px; }
.ad-info-grid { display:grid; grid-template-columns:1fr 1fr; gap:15px; text-align:center; }
.ad-info-item h3 { font-size:20px; font-weight:600; margin:0 0 5px 0; color:#ffffff; }
.ad-info-item p { font-size:14px; color:var(--tg-theme-hint-color); margin:0; }
.ad-buttons { display:flex; flex-direction:column; gap:15px; margin-bottom:25px; }
.btn {
    width:100%; padding:16px; font-size:18px; font-weight:600; border:none; border-radius:12px; cursor:pointer;
    transition:transform 0.2s ease, background-color 0.2s ease, box-shadow 0.2s ease;
    background: linear-gradient(145deg, var(--tg-theme-button-color), #0056b3); color: var(--tg-theme-button-text-color);
    box-shadow:0 4px 10px rgba(0,123,255,0.2);
}
.btn:hover { transform:translateY(-2px); box-shadow:0 6px 15px rgba(0,123,255,0.3); }
.btn:active { transform:scale(0.98); }
.btn:disabled { background:#555; color:#888; cursor:not-allowed; box-shadow:none; transform:none; }
#mainWithdrawBtn { background:linear-gradient(145deg, var(--success-color), #1e7e34); box-shadow:0 4px 10px rgba(40,167,69,0.2); }
#mainWithdrawBtn:disabled { background:#555; box-shadow:none; }
.status-message {
    position:fixed; bottom:80px; left:50%; transform:translateX(-50%); width:90%; max-width:480px;
    padding:12px 15px; border-radius:10px; font-weight:500; display:none; animation:fadeIn 0.3s; z-index:1000; box-sizing:border-box;
}
.success { display:block; background-color: rgba(40,167,69,0.25); border-left:5px solid var(--success-color); color:var(--success-color);}
.error { display:block; background-color: rgba(220,53,69,0.25); border-left:5px solid var(--danger-color); color:var(--danger-color);}
.info { display:block; background-color: rgba(0,123,255,0.25); border-left:5px solid var(--tg-theme-button-color); color:#008cff;}
.footer-nav {
    position:fixed; bottom:0; left:0; right:0; background-color: var(--secondary-bg-color); display:flex;
    justify-content:space-around; padding:10px 0; box-shadow:0 -4px 12px rgba(0,0,0,0.3);
    border-top:1px solid var(--border-color); z-index:999;
}
.nav-btn { background:none; border:none; color: var(--tg-theme-hint-color); display:flex; flex-direction:column; align-items:center;
    font-size:12px; font-weight:500; cursor:pointer; padding:5px 15px; border-radius:12px; transition:color 0.2s, background-color 0.2s;}
.nav-btn.active { color: var(--tg-theme-button-color);}
.nav-btn:hover:not(.active) { color:#ffffff;}
.nav-btn .icon { width:28px; height:28px; margin-bottom:4px;}
.input-group { margin-bottom:20px; text-align:left;}
.input-group label { display:block; margin-bottom:8px; color: var(--tg-theme-hint-color); font-size:14px; font-weight:500;}
.input-group input {
    width:100%; padding:14px; border-radius:10px; border:1px solid var(--border-color);
    background-color:#333; color: var(--tg-theme-text-color); font-size:16px; box-sizing:border-box;
}
.input-group input:focus { outline:none; border-color:var(--tg-theme-button-color); box-shadow:0 0 0 3px rgba(0,123,255,0.2);}
#referralLink {
    background-color:#111; padding:15px; border-radius:10px; word-wrap:break-word; border:1px dashed var(--tg-theme-hint-color); margin-top:15px; cursor:pointer; color:#e0e0e0; transition: background-color 0.2s; text-align:left;
}
#referralLink:hover { background-color:#2a2a2a; }
.admin-panel { display:none; margin-top:30px; padding:15px; border:1px solid var(--warning-color); border-radius:10px; background-color: rgba(255,193,7,0.1);}
.admin-panel h3 { color: var(--warning-color); margin-top:0; }
</style>
</head>
<body>
<div class="container">

<!-- Home View -->
<div id="home-view" class="view">
    <div class="header"><h1>BD TM EARNING BOT</h1><p>Watch Ads and Earn BDT</p></div>
    <div class="card">
        <h2>Current Balance</h2>
        <div class="balance-amount" id="balanceDisplay">‡ß≥0.00</div>
        <div class="ad-info-grid">
            <div class="ad-info-item"><h3 id="adCountDisplay">0</h3><p>Total Ads Watched</p></div>
            <div class="ad-info-item"><h3 id="dailyAdCountDisplay">0 / 1000</h3><p>Today's Ads</p></div>
        </div>
    </div>
    <div class="ad-buttons"><button class="btn" id="rewardedBtn">Watch Ad (+‡ß≥0.20)</button></div>
    <button class="btn" id="mainWithdrawBtn" disabled>Reach ‡ß≥10.00 to Withdraw</button>
</div>

<!-- Withdraw View -->
<div id="withdraw-view" class="view">
    <div class="header"><h1>Withdraw</h1><p>Request your earnings</p></div>
    <div class="card">
        <h2>Your Balance</h2>
        <div class="balance-amount" id="withdrawBalanceDisplay">‡ß≥0.00</div>
        <p style="color: var(--tg-theme-hint-color); margin-top:15px;">Minimum withdrawal is ‡ß≥10.00</p>
    </div>
    <div class="card">
        <h2>Payment Details</h2>
        <div class="input-group">
            <label for="paymentNumber">Your Bkash Number</label>
            <input type="text" id="paymentNumber" placeholder="e.g., 01XXXXXXXXX">
        </div>
        <button class="btn" id="finalWithdrawBtn" disabled>Withdraw</button>
    </div>
</div>

<!-- Referral View -->
<div id="referral-view" class="view">
    <div class="header"><h1>Referrals</h1><p>Invite friends and earn more!</p></div>
    <div class="card">
        <h2>Your Referral Stats</h2>
        <div class="ad-info-grid">
            <div class="ad-info-item"><h3 id="referralCountDisplay">0</h3><p>Total Referrals</p></div>
            <div class="ad-info-item"><h3 id="referralBonusDisplay">‡ß≥0.00</h3><p>Referral Earnings</p></div>
        </div>
    </div>
    <div class="card">
        <h2>Your Referral Link</h2>
        <p>Share this link with friends. You get ‡ß≥1 per verified friend who joins!</p>
        <p id="referralLink" title="Click to copy"></p>
    </div>
</div>

<div class="status-message" id="statusMessage"></div>
<div class="admin-panel" id="adminPanel"><h3>üëë Admin Panel</h3><p id="userInfo"></p></div>
</div>

<!-- Footer -->
<footer class="footer-nav">
    <button class="nav-btn active" id="navHome">Home</button>
    <button class="nav-btn" id="navWithdraw">Withdraw</button>
    <button class="nav-btn" id="navRefer">Referrals</button>
</footer>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const tg = window.Telegram.WebApp;

    const balanceDisplay = document.getElementById('balanceDisplay'),
          adCountDisplay = document.getElementById('adCountDisplay'),
          dailyAdCountDisplay = document.getElementById('dailyAdCountDisplay'),
          rewardedBtn = document.getElementById('rewardedBtn'),
          mainWithdrawBtn = document.getElementById('mainWithdrawBtn'),
          withdrawBalanceDisplay = document.getElementById('withdrawBalanceDisplay'),
          paymentNumberInput = document.getElementById('paymentNumber'),
          finalWithdrawBtn = document.getElementById('finalWithdrawBtn'),
          referralLinkDisplay = document.getElementById('referralLink'),
          referralCountDisplay = document.getElementById('referralCountDisplay'),
          referralBonusDisplay = document.getElementById('referralBonusDisplay');

    const statusMessage = document.getElementById('statusMessage');

    const ADMIN_ID = 7691157254;
    const BOT_USERNAME = 'BD_TM_ADS_EARNING_BOT';
    const WITHDRAW_THRESHOLD = 10; // 10 ‡¶ü‡¶æ‡¶ï‡¶æ
    const AD_REWARD = 0.2; // ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶è‡¶° 0.20 ‡¶ü‡¶æ‡¶ï‡¶æ
    const REFERRAL_BONUS = 1; // ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ 1 ‡¶ü‡¶æ‡¶ï‡¶æ
    const DAILY_AD_LIMIT = 1000;

    let state = { balance:0, totalAds:0, dailyAds:0, lastAdDate:null, referralCount:0 };

    function getToday(){ return new Date().toISOString().split('T')[0]; }

    function loadState(){
        try{
            const saved = JSON.parse(localStorage.getItem('earningAppBDTState'));
            if(saved){ state={...state,...saved}; }
        }catch(e){}
        if(state.lastAdDate!==getToday()){ state.dailyAds=0; state.lastAdDate=getToday(); saveState();}
    }

    function saveState(){ localStorage.setItem('earningAppBDTState',JSON.stringify(state)); }

    function updateUI(){
        balanceDisplay.textContent = `‡ß≥${state.balance.toFixed(2)}`;
        adCountDisplay.textContent = state.totalAds;
        dailyAdCountDisplay.textContent = `${state.dailyAds} / ${DAILY_AD_LIMIT}`;
        withdrawBalanceDisplay.textContent = `‡ß≥${state.balance.toFixed(2)}`;
        referralCountDisplay.textContent = state.referralCount;
        referralBonusDisplay.textContent = `‡ß≥${(state.referralCount*REFERRAL_BONUS).toFixed(2)}`;

        const canWithdraw = state.balance>=WITHDRAW_THRESHOLD;
        mainWithdrawBtn.disabled = !canWithdraw;
        mainWithdrawBtn.textContent = canWithdraw ? 'Go to Withdraw' : `Reach ‡ß≥${WITHDRAW_THRESHOLD.toFixed(2)} to Withdraw`;
        finalWithdrawBtn.disabled = !canWithdraw;
        finalWithdrawBtn.textContent = canWithdraw ? `Withdraw ‡ß≥${state.balance.toFixed(2)}` : `Minimum ‡ß≥${WITHDRAW_THRESHOLD.toFixed(2)} required`;
        const adLimitReached = state.dailyAds>=DAILY_AD_LIMIT;
        rewardedBtn.disabled = adLimitReached;
        rewardedBtn.textContent = adLimitReached ? 'Daily Limit Reached' : `Watch Ad (+‡ß≥${AD_REWARD})`;
    }

    function showStatus(msg,type='info',dur=4000){
        statusMessage.textContent=msg; statusMessage.className=`status-message ${type}`;
        statusMessage.style.display='block';
        setTimeout(()=>{statusMessage.style.display='none';},dur);
    }

    function handleAdSuccess(){
        state.totalAds++; state.dailyAds++; state.balance+=AD_REWARD;
        saveState(); updateUI();
        showStatus(`Success! +‡ß≥${AD_REWARD.toFixed(2)} added.`,'success');
    }

    function requestAd(){
        if(state.dailyAds>=DAILY_AD_LIMIT){ showStatus('Daily limit reached','error'); return;}
        showStatus('Loading ad...','info');
        Promise.resolve(show_9802379()).then(handleAdSuccess).catch(()=>showStatus('Ad failed.','error'));
    }

    function handleWithdraw(){
        if(state.balance<WITHDRAW_THRESHOLD){ showStatus(`Minimum ‡ß≥${WITHDRAW_THRESHOLD} required`,'error'); return;}
        const number = paymentNumberInput.value.trim();
        if(!/^01[0-9]{9}$/.test(number)){ showStatus('Enter valid Bkash number','error'); return;}
        const user=tg.initDataUnsafe.user;
        const message = `--- Withdrawal Request ---\nUser ID:${user.id}\nName:${user.first_name} ${user.last_name||''}\nUsername:@${user.username||'N/A'}\nAmount: ‡ß≥${state.balance.toFixed(2)}\nBkash Number: ${number}`;
        tg.sendData(message);
        showStatus('Withdrawal request sent','success');
        state.balance=0; saveState(); updateUI(); paymentNumberInput.value=''; showView('home-view');
    }

    function generateReferralLink(){
        const user=tg.initDataUnsafe.user;
        if(user && user.id){ referralLinkDisplay.textContent=`https://t.me/${BOT_USERNAME}?start=${user.id}`; }
    }

    referralLinkDisplay.addEventListener('click',()=>{
        navigator.clipboard.writeText(referralLinkDisplay.textContent);
        showStatus('Referral link copied','success');
    });

    rewardedBtn.addEventListener('click',requestAd);
    mainWithdrawBtn.addEventListener('click',()=>showView('withdraw-view'));
    finalWithdrawBtn.addEventListener('click',handleWithdraw);

    document.getElementById('navHome').addEventListener('click',()=>showView('home-view'));
    document.getElementById('navWithdraw').addEventListener('click',()=>showView('withdraw-view'));
    document.getElementById('navRefer').addEventListener('click',()=>showView('referral-view'));

    function showView(id){
        document.querySelectorAll('.view').forEach(v=>v.style.display='none');
        document.getElementById(id).style.display='block';
        document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
        const navMap={'home-view':'navHome','withdraw-view':'navWithdraw','referral-view':'navRefer'};
        if(navMap[id]) document.getElementById(navMap[id]).classList.add('active');
    }

    loadState(); updateUI(); generateReferralLink();
});
</script>
</body>
</html><!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>BD TM EARNING BOT</title>

<!-- Monetage SDK -->
<script src='//libtl.com/sdk.js' data-zone='9802379' data-sdk='show_9802379'></script>
<!-- Telegram Web App -->
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
:root {
    --tg-theme-bg-color: #121212; --tg-theme-text-color: #e0e0e0; --tg-theme-button-color: #007bff;
    --tg-theme-button-text-color: #ffffff; --tg-theme-hint-color: #8a8a8a; --success-color: #28a745;
    --warning-color: #ffc107; --danger-color: #dc3545; --secondary-bg-color: #1e1e1e; --border-color: #333333;
}
body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
    margin:0; padding:20px 15px 90px 15px;
    background-color: var(--tg-theme-bg-color); color: var(--tg-theme-text-color);
    display:flex; flex-direction:column; align-items:center; text-align:center; min-height:100vh; box-sizing:border-box;
}
.container { width:100%; max-width:500px; }
.view { display:none; width:100%; animation:fadeIn 0.3s ease-in-out; }
#home-view { display:block; }
@keyframes fadeIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }
.header { margin-bottom:25px; }
.header h1 { font-size:32px; font-weight:700; margin-bottom:5px; color:#ffffff; }
.header p { color: var(--tg-theme-hint-color); font-size:16px; }
.card {
    background-color: var(--secondary-bg-color); padding:25px; border-radius:16px; margin-bottom:25px;
    box-shadow:0 8px 16px rgba(0,0,0,0.2); border:1px solid var(--border-color);
}
.card h2 { margin:0 0 12px 0; font-size:16px; color:var(--tg-theme-hint-color); font-weight:500; text-transform:uppercase; letter-spacing:0.5px; }
.balance-amount { font-size:42px; font-weight:700; color:#ffffff; margin-bottom:10px; }
.ad-info-grid { display:grid; grid-template-columns:1fr 1fr; gap:15px; text-align:center; }
.ad-info-item h3 { font-size:20px; font-weight:600; margin:0 0 5px 0; color:#ffffff; }
.ad-info-item p { font-size:14px; color:var(--tg-theme-hint-color); margin:0; }
.ad-buttons { display:flex; flex-direction:column; gap:15px; margin-bottom:25px; }
.btn {
    width:100%; padding:16px; font-size:18px; font-weight:600; border:none; border-radius:12px; cursor:pointer;
    transition:transform 0.2s ease, background-color 0.2s ease, box-shadow 0.2s ease;
    background: linear-gradient(145deg, var(--tg-theme-button-color), #0056b3); color: var(--tg-theme-button-text-color);
    box-shadow:0 4px 10px rgba(0,123,255,0.2);
}
.btn:hover { transform:translateY(-2px); box-shadow:0 6px 15px rgba(0,123,255,0.3); }
.btn:active { transform:scale(0.98); }
.btn:disabled { background:#555; color:#888; cursor:not-allowed; box-shadow:none; transform:none; }
#mainWithdrawBtn { background:linear-gradient(145deg, var(--success-color), #1e7e34); box-shadow:0 4px 10px rgba(40,167,69,0.2); }
#mainWithdrawBtn:disabled { background:#555; box-shadow:none; }
.status-message {
    position:fixed; bottom:80px; left:50%; transform:translateX(-50%); width:90%; max-width:480px;
    padding:12px 15px; border-radius:10px; font-weight:500; display:none; animation:fadeIn 0.3s; z-index:1000; box-sizing:border-box;
}
.success { display:block; background-color: rgba(40,167,69,0.25); border-left:5px solid var(--success-color); color:var(--success-color);}
.error { display:block; background-color: rgba(220,53,69,0.25); border-left:5px solid var(--danger-color); color:var(--danger-color);}
.info { display:block; background-color: rgba(0,123,255,0.25); border-left:5px solid var(--tg-theme-button-color); color:#008cff;}
.footer-nav {
    position:fixed; bottom:0; left:0; right:0; background-color: var(--secondary-bg-color); display:flex;
    justify-content:space-around; padding:10px 0; box-shadow:0 -4px 12px rgba(0,0,0,0.3);
    border-top:1px solid var(--border-color); z-index:999;
}
.nav-btn { background:none; border:none; color: var(--tg-theme-hint-color); display:flex; flex-direction:column; align-items:center;
    font-size:12px; font-weight:500; cursor:pointer; padding:5px 15px; border-radius:12px; transition:color 0.2s, background-color 0.2s;}
.nav-btn.active { color: var(--tg-theme-button-color);}
.nav-btn:hover:not(.active) { color:#ffffff;}
.nav-btn .icon { width:28px; height:28px; margin-bottom:4px;}
.input-group { margin-bottom:20px; text-align:left;}
.input-group label { display:block; margin-bottom:8px; color: var(--tg-theme-hint-color); font-size:14px; font-weight:500;}
.input-group input {
    width:100%; padding:14px; border-radius:10px; border:1px solid var(--border-color);
    background-color:#333; color: var(--tg-theme-text-color); font-size:16px; box-sizing:border-box;
}
.input-group input:focus { outline:none; border-color:var(--tg-theme-button-color); box-shadow:0 0 0 3px rgba(0,123,255,0.2);}
#referralLink {
    background-color:#111; padding:15px; border-radius:10px; word-wrap:break-word; border:1px dashed var(--tg-theme-hint-color); margin-top:15px; cursor:pointer; color:#e0e0e0; transition: background-color 0.2s; text-align:left;
}
#referralLink:hover { background-color:#2a2a2a; }
.admin-panel { display:none; margin-top:30px; padding:15px; border:1px solid var(--warning-color); border-radius:10px; background-color: rgba(255,193,7,0.1);}
.admin-panel h3 { color: var(--warning-color); margin-top:0; }
</style>
</head>
<body>
<div class="container">

<!-- Home View -->
<div id="home-view" class="view">
    <div class="header"><h1>BD TM EARNING BOT</h1><p>Watch Ads and Earn BDT</p></div>
    <div class="card">
        <h2>Current Balance</h2>
        <div class="balance-amount" id="balanceDisplay">‡ß≥0.00</div>
        <div class="ad-info-grid">
            <div class="ad-info-item"><h3 id="adCountDisplay">0</h3><p>Total Ads Watched</p></div>
            <div class="ad-info-item"><h3 id="dailyAdCountDisplay">0 / 1000</h3><p>Today's Ads</p></div>
        </div>
    </div>
    <div class="ad-buttons"><button class="btn" id="rewardedBtn">Watch Ad (+‡ß≥0.20)</button></div>
    <button class="btn" id="mainWithdrawBtn" disabled>Reach ‡ß≥10.00 to Withdraw</button>
</div>

<!-- Withdraw View -->
<div id="withdraw-view" class="view">
    <div class="header"><h1>Withdraw</h1><p>Request your earnings</p></div>
    <div class="card">
        <h2>Your Balance</h2>
        <div class="balance-amount" id="withdrawBalanceDisplay">‡ß≥0.00</div>
        <p style="color: var(--tg-theme-hint-color); margin-top:15px;">Minimum withdrawal is ‡ß≥10.00</p>
    </div>
    <div class="card">
        <h2>Payment Details</h2>
        <div class="input-group">
            <label for="paymentNumber">Your Bkash Number</label>
            <input type="text" id="paymentNumber" placeholder="e.g., 01XXXXXXXXX">
        </div>
        <button class="btn" id="finalWithdrawBtn" disabled>Withdraw</button>
    </div>
</div>

<!-- Referral View -->
<div id="referral-view" class="view">
    <div class="header"><h1>Referrals</h1><p>Invite friends and earn more!</p></div>
    <div class="card">
        <h2>Your Referral Stats</h2>
        <div class="ad-info-grid">
            <div class="ad-info-item"><h3 id="referralCountDisplay">0</h3><p>Total Referrals</p></div>
            <div class="ad-info-item"><h3 id="referralBonusDisplay">‡ß≥0.00</h3><p>Referral Earnings</p></div>
        </div>
    </div>
    <div class="card">
        <h2>Your Referral Link</h2>
        <p>Share this link with friends. You get ‡ß≥1 per verified friend who joins!</p>
        <p id="referralLink" title="Click to copy"></p>
    </div>
</div>

<div class="status-message" id="statusMessage"></div>
<div class="admin-panel" id="adminPanel"><h3>üëë Admin Panel</h3><p id="userInfo"></p></div>
</div>

<!-- Footer -->
<footer class="footer-nav">
    <button class="nav-btn active" id="navHome">Home</button>
    <button class="nav-btn" id="navWithdraw">Withdraw</button>
    <button class="nav-btn" id="navRefer">Referrals</button>
</footer>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const tg = window.Telegram.WebApp;

    const balanceDisplay = document.getElementById('balanceDisplay'),
          adCountDisplay = document.getElementById('adCountDisplay'),
          dailyAdCountDisplay = document.getElementById('dailyAdCountDisplay'),
          rewardedBtn = document.getElementById('rewardedBtn'),
          mainWithdrawBtn = document.getElementById('mainWithdrawBtn'),
          withdrawBalanceDisplay = document.getElementById('withdrawBalanceDisplay'),
          paymentNumberInput = document.getElementById('paymentNumber'),
          finalWithdrawBtn = document.getElementById('finalWithdrawBtn'),
          referralLinkDisplay = document.getElementById('referralLink'),
          referralCountDisplay = document.getElementById('referralCountDisplay'),
          referralBonusDisplay = document.getElementById('referralBonusDisplay');

    const statusMessage = document.getElementById('statusMessage');

    const ADMIN_ID = 7691157254;
    const BOT_USERNAME = 'BD_TM_ADS_EARNING_BOT';
    const WITHDRAW_THRESHOLD = 10; // 10 ‡¶ü‡¶æ‡¶ï‡¶æ
    const AD_REWARD = 0.2; // ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶è‡¶° 0.20 ‡¶ü‡¶æ‡¶ï‡¶æ
    const REFERRAL_BONUS = 1; // ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ 1 ‡¶ü‡¶æ‡¶ï‡¶æ
    const DAILY_AD_LIMIT = 1000;

    let state = { balance:0, totalAds:0, dailyAds:0, lastAdDate:null, referralCount:0 };

    function getToday(){ return new Date().toISOString().split('T')[0]; }

    function loadState(){
        try{
            const saved = JSON.parse(localStorage.getItem('earningAppBDTState'));
            if(saved){ state={...state,...saved}; }
        }catch(e){}
        if(state.lastAdDate!==getToday()){ state.dailyAds=0; state.lastAdDate=getToday(); saveState();}
    }

    function saveState(){ localStorage.setItem('earningAppBDTState',JSON.stringify(state)); }

    function updateUI(){
        balanceDisplay.textContent = `‡ß≥${state.balance.toFixed(2)}`;
        adCountDisplay.textContent = state.totalAds;
        dailyAdCountDisplay.textContent = `${state.dailyAds} / ${DAILY_AD_LIMIT}`;
        withdrawBalanceDisplay.textContent = `‡ß≥${state.balance.toFixed(2)}`;
        referralCountDisplay.textContent = state.referralCount;
        referralBonusDisplay.textContent = `‡ß≥${(state.referralCount*REFERRAL_BONUS).toFixed(2)}`;

        const canWithdraw = state.balance>=WITHDRAW_THRESHOLD;
        mainWithdrawBtn.disabled = !canWithdraw;
        mainWithdrawBtn.textContent = canWithdraw ? 'Go to Withdraw' : `Reach ‡ß≥${WITHDRAW_THRESHOLD.toFixed(2)} to Withdraw`;
        finalWithdrawBtn.disabled = !canWithdraw;
        finalWithdrawBtn.textContent = canWithdraw ? `Withdraw ‡ß≥${state.balance.toFixed(2)}` : `Minimum ‡ß≥${WITHDRAW_THRESHOLD.toFixed(2)} required`;
        const adLimitReached = state.dailyAds>=DAILY_AD_LIMIT;
        rewardedBtn.disabled = adLimitReached;
        rewardedBtn.textContent = adLimitReached ? 'Daily Limit Reached' : `Watch Ad (+‡ß≥${AD_REWARD})`;
    }

    function showStatus(msg,type='info',dur=4000){
        statusMessage.textContent=msg; statusMessage.className=`status-message ${type}`;
        statusMessage.style.display='block';
        setTimeout(()=>{statusMessage.style.display='none';},dur);
    }

    function handleAdSuccess(){
        state.totalAds++; state.dailyAds++; state.balance+=AD_REWARD;
        saveState(); updateUI();
        showStatus(`Success! +‡ß≥${AD_REWARD.toFixed(2)} added.`,'success');
    }

    function requestAd(){
        if(state.dailyAds>=DAILY_AD_LIMIT){ showStatus('Daily limit reached','error'); return;}
        showStatus('Loading ad...','info');
        Promise.resolve(show_9802379()).then(handleAdSuccess).catch(()=>showStatus('Ad failed.','error'));
    }

    function handleWithdraw(){
        if(state.balance<WITHDRAW_THRESHOLD){ showStatus(`Minimum ‡ß≥${WITHDRAW_THRESHOLD} required`,'error'); return;}
        const number = paymentNumberInput.value.trim();
        if(!/^01[0-9]{9}$/.test(number)){ showStatus('Enter valid Bkash number','error'); return;}
        const user=tg.initDataUnsafe.user;
        const message = `--- Withdrawal Request ---\nUser ID:${user.id}\nName:${user.first_name} ${user.last_name||''}\nUsername:@${user.username||'N/A'}\nAmount: ‡ß≥${state.balance.toFixed(2)}\nBkash Number: ${number}`;
        tg.sendData(message);
        showStatus('Withdrawal request sent','success');
        state.balance=0; saveState(); updateUI(); paymentNumberInput.value=''; showView('home-view');
    }

    function generateReferralLink(){
        const user=tg.initDataUnsafe.user;
        if(user && user.id){ referralLinkDisplay.textContent=`https://t.me/${BOT_USERNAME}?start=${user.id}`; }
    }

    referralLinkDisplay.addEventListener('click',()=>{
        navigator.clipboard.writeText(referralLinkDisplay.textContent);
        showStatus('Referral link copied','success');
    });

    rewardedBtn.addEventListener('click',requestAd);
    mainWithdrawBtn.addEventListener('click',()=>showView('withdraw-view'));
    finalWithdrawBtn.addEventListener('click',handleWithdraw);

    document.getElementById('navHome').addEventListener('click',()=>showView('home-view'));
    document.getElementById('navWithdraw').addEventListener('click',()=>showView('withdraw-view'));
    document.getElementById('navRefer').addEventListener('click',()=>showView('referral-view'));

    function showView(id){
        document.querySelectorAll('.view').forEach(v=>v.style.display='none');
        document.getElementById(id).style.display='block';
        document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
        const navMap={'home-view':'navHome','withdraw-view':'navWithdraw','referral-view':'navRefer'};
        if(navMap[id]) document.getElementById(navMap[id]).classList.add('active');
    }

    loadState(); updateUI(); generateReferralLink();
});
</script>
</body>
</html>